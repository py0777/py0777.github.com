## 대체와 이체 는 금융사 출납또는 뱅킹 파트에서 많이 사용하는 업무이다.

> 대체는 A증권사의 1번계좌와 2번계좌간의 자금의 이동을 대체라고 한다.
> 이체는 A증권사의 1번계좌에서 B증권사의 1번계좌로 자금의 이동을 이체라고 한다.
> 타사대체(입출고 관련)업무는 A증권사의 1번계좌의 유가잔고를 B증권사 1번계좌로 이동할때도 사용된다.
>
> 대체는 '보통 바꾼다, 교체한다.'라고 표현해서 그런지, 타사대체의 경우 실제 유가잔고가 예탁원에 보관되어있어 그 소유주만 바꾸는 형태가 되어 타사이체가 아닌 타사대체라는 표현을 사용한다.

### **◎ 대체처리 프로세스**

1. 화면에서 사용자가 A계좌와 B계좌 그리고 대체 금액을 입력한 후 전송버튼을 누른다.
2. 출납서비스에서 A계좌에서 자금을 출금하고, B계좌에 입금을 한다. ( A계좌 주와 B계좌주가 동일인인 경우, 수표금액도 대체가능 하지만, 동일인이 아닌 경우 수표금액은 대체 불가능하다. 수표는 익영업일 수표교환결제 시간이후 대체또는 출금 가능하다.)

|화면       || 출납      |
| :--------: |:--------:| :--------: |
|          |①|         |
|대체실행   |→| 대체출금 |
|          |←|         |
|          |②|          |

### **◎ 이체처리 프로세스**

1. 화면에서 사용자가 A계좌와 타사 B계좌 그리고 이체금액을 입력한 후 전송버튼을 누른다. 화면은 처리완료 전까지 대기상태로 기다린다.
2. 출납프로그램에서 출금 처리를 한 이후 뱅킹 모듈을 호출해 이체요청한다.
3. 뱅킹프로그램은 출납에서 보내온 인풋으로 전문을 조립해 전문송신 테이블에 등록한 이후 FEP를 통해 전문을 송신한다.
4. FEP(Front End Processor)는 은행망또는 지급 결제망으로 전문을 송신한다.
5. 상대기관으로 부터 송신에대한 응답을 받는다.(async 프로세스로, 이체처리 transaction은 commit된 상태임)
6. 뱅킹프로그램에선 전문을 분석해 송신테이블에서 송신에대한 응답프로그램을 찾아 해당하는 프로그램을 호출한다.
7. 만약 오류응답을 받았을 경우, 원거래에대한 출금 취소처리를 하지만, 정상일 경우는 pass 를 한다.(뱅킹에서 출금취소를 하는게 여러모로 편하다)  출납에선 응답이 정상일 경우는 정상메시지를 조립해 화면으로 보낸다. 만약, 오류응답일 경우 오류메시지를 화면으로 보낸다(보통 push서버를 이용). 이체출금 프로그램과 별도로 이체응답프로그램에서 처리를 하는데 정상응답일 경우 전표나 sms 처리도 여기서 한다.
8. 응답메시지를 받은 화면은 하단에 메시지를 뿌리고, 대기상태에서 풀린다.
|화면		||출납|		|뱅킹|		|FEP|		|은행망/결제망|
|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
|          |①|	        |②|		|③|		|④|
|이체실행	|→|	이체출금  |→| 전문 조립	|→|	전문 송신 |→| 전문 수신|
|          |←|	후 처리 |←| 전문 분석 |←| 응답 수신 |←| 응답 송신|
|          |⑧|         |⑦|          |⑥|          |⑤|        |