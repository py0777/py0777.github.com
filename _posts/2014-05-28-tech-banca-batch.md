---
title: "방카슈랑스 보험사 배치"
categories:
  - Tech
tags: 
  - 보험사배치
  - 은행
  - 금융IT
toc: true
toc_sticky: true
toc_label: 목차
popular: true
---
![image](https://py0777.github.io/assets/image/banca-batch/banca-batch_1.jpg)
## **방카슈랑스 보험사 배치**

#### **보험사 배치**

: 은행과 보험사간 대량의 데이터를 일괄적으로 처리해야 하는 경우, 보험사에서 배치처리대상을 파일형태로 은행으로 보내줍니다. 은행에선 배치처리후 오류내역을 파일형태로 보험사로 보내게됩니다.

\1. 계약, 지급, 문서 접수처리 등의 결과 또는 변경사항등을 보험사에서 은행으로 .txt 파일 형태로 보냄.

\2. 파일명은 보험사코드와 전문번호, 처리일자등을 포함하고 있어 파일명으로 어떤 목적의 파일인지 알 수 있음. 파일은 UTF-8 로 보내주며, 다른 CHARSET으로 보낼 경우, 한글깨짐 형상이 발생함. 파일 내용은 HEADER와 DATA부 TAIL 부로 이뤄져 있으며 DATA 부는 약속된 전문 레이아웃에 맞게 보내줌.
(전문 구성시 데이터부의 속성 값들 구분자 '|'또는 '#'등으로 구분하면 한글이 포함된 전문 파싱시 length로 짜르는 것보다 오류가 적음)

\3. 보험사에서 보내온 파일을 읽어 DATA 부를 한 줄씩 처리함. 이때, 배치 프로그램의 COMMIT COUNT는 1이어야 합니다. 왜냐하면 10번째 라인에서 오류발생할 경우, 해당 라인만 ROLLBACK처리 하고, 이전에 정상처리된 결과는 COMMIT되야 하기 때문입니다.

\4. 보험사 파일의 전문번호와 프로그램이 맵핑된 테이블이 존재해야 하며, 배치프로그램은 특정시간마다 반복해서 수행하면서 파일이 존재하면 관련된 프로그램을 호출합니다.(증권사 뱅킹거래와 유사하지만, ASYNC 처리됨)

\5. 프로그램에서 오류 발생시 오류내역을 특정 테이블에 닮아 두고, 오류내역을 파일로만들어 정해진 시간마다 보험사로 보냄.  (증권번호 미존재, 데이터 갯수 틑림등 보험사에서 조치해 줘야할 내용을 보냅니다. 은행이체전문처럼 실시간으로 보내진 않습니다.)

![image](https://py0777.github.io/assets/image/banca-batch/banca-batch_2.jpg)

```uml
df
```

```SQL
/*보험사배치 추출 SQL*/
SELECT 프로그램ID
     , 담당자
 FROM  보험사배치명세    
 WHERE 그룹번호 = :그룹번호
   AND 전문번호 = :전문번호
   AND 사용여부 = 'Y'
ORDER BY SEQ DESC

/*보험사배치 처리결과 조회*/
SELECT  B.기관명
     ,  A.*
  FROM  보험사배치처리결과 A
     ,  제휴기관관리 B
 WHERE  A.처리일자 = TO_CHAR(SYSDATE , 'YYYYMMDD')
   AND  A.기관코드 = B.기관코드
   AND  A.총건수 > 0

/*보험사배치 오류내역 조회
  보험사로는 비즈니스 오류만 송신
  시스템오류는 은행 프로그램 담당자에게 수정요청
*/
SELECT  A.담당자
     ,  C.기관명
     ,  B.*
  FROM  보험사배치명세 A
     ,  보험사배치오류내역 B
     ,  제휴기관관리 C
 WHERE  A.전문번호 = B.전문번호
   AND  B.기관코드 = C.기관코드
   AND  B.처리일자 = TO_CHAR(SYSDATE , 'YYYYMMDD')
   AND  B.오류유형구분 = '2'  /*2: 비즈니스오류 3:시스템오류*/
```

**생각해볼 문제**

은행에서 보험사 배치중 일부는 API형태로 보험사에 제공하는 것도 좋을 듯합니다. 계약의 변경상태를 보험사와 은행간 실시간으로 SYNC를 맞출수 있어 정보차이를 줄일 수 있습니다. 파일송수신 배치프로그램이 늘어날수록 은행/보험사의 파일저장공간을 늘려야 하고, 파일수신여부를 보험사에 확인해줘야 하는 귀찮은 일이 늘어나게 됩니다.