---
title: "집계와 정산표"
categories:

  - Tech
tags: 
  - 출금처리설계
  - 증권
  - 금융IT
toc: true
toc_sticky: true
toc_label: 목차
popular: true
---

차세대 증권 프로젝트가 끝날때 쯤 이슈로 나오는 단골손님 중 하나가 집계와 정산표 그리고 마감 이다.
프로젝트 개발 초반에는 조회용 화면을 개발하고, 중반엔 처리성 로직을 만들고 완성도를 높이다 보면, 어느새 오픈일이 가까워 진다.

그때가 오면, 
>'정산표가 안맞네, 집계가 안맞네, 마감이 안되네.'
하며 고객들이 그 동안의 프로그램을 불신하고 오픈에 대한 두려움을 갖게 된다.
(개발기간 중엔 거래내역과 예수금, 잔고를 누구나 UPDATE 하기때문에 정산표와 집계가 맞지 않을 가능성이 높다. 이들을 맞추기위해선 별도의 테스트 프로세스가 필요하다.)

**그렇다면, 이 집계와 정산표 화면이 왜 필요한 것일까?**
집계는 거래가 발생하면, 일자 지점별로 예수금, 미수, 잔고수량, 신용금액 등을 실시간으로 관리한다.
( 거래는 일자 계좌별로 발생하고, 집계는 일자 지점별로 발생하기 때문에 거래내역 발생시 집계내역을 갱신하게 되면, 테이블 LOCK이 발생한다.
이 해결책으로 거래내역 PK로 한 로그성 테이블을 만들어 디퍼드 방식으로 집계테이블을 갱신하는 것이다. )

지점 마감 또는 회계 2차 마감때, 예수금 잔고와 집계잔고, 회계예수금 계정별 잔고를 비교해 마감 처리를 한다. 만약 이들 중 한가지라도 금액이 틀리게 되면 마감이 되지 않는다. 결국, 회사의 자금흐름과 잔고가 맞는지를 확인하기 위해서 필요하다.

정산표 화면은 지점별 상품별 잔고 및 적요별 입출을 보여주는 화면이다.
정산표화면은 집계테이블에 쌓인 것을 보여주기 때문에, 정산표화면에 요구사항이 변경 될때마다, 집계테이블이 변경될 수 있다.
하지만, 개인적인 생각으론 정산표 화면은 중요하지 않다고 생각한다. 왜냐하면, 결국 마감을 위해 집계를 쌓고있는 거라면, 굳이 전산이 아닌 현업에서
정산표화면을 볼필요가 있을까? 전산팀에서 집계와 거래내역 예수금을 비교하면 틀린 부분이 있는지 찾아주는게 맞지 않을까? 현업에선 마감처리시 마감이 안 될경우, 전산팀에 확인을 받으면 되지 않을까 생각된다.